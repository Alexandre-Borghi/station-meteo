<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8">
    <link rel="manifest" href="/assets/manifest.json" />

    <title>Station Météo</title>
    <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
    <div id="main">
        <div id="weather">
            <div>
                <div id="exterior" class="big"></div>
                Extérieur
            </div>
            <div>
                <div id="apparent" class="big"></div>
                Ressenti
            </div>
        </div>
        <div id="clock"></div>
    </div>

    <script type="module">
        const clock = document.getElementById("clock");
        setInterval(updateClock, 400);
        function updateClock() {
            const now = new Date();
            const hh = now.getHours().toString().padStart(2, '0');
            const mm = now.getMinutes().toString().padStart(2, '0');
            const ss = now.getSeconds().toString().padStart(2, '0');
            clock.innerHTML = `${hh}:${mm}:${ss}`;
        }

        const API_URL = "https://api.open-meteo.com/v1/forecast?latitude=47.703428385725054&longitude=-2.651987137064598&current=temperature_2m,apparent_temperature";
        const weather = document.getElementById("weather");
        const exterior = weather.querySelector("#exterior");
        const apparent = weather.querySelector("#apparent");
        setInterval(updateWeather, 3 * 60 * 1000);
        updateWeather();
        async function updateWeather() {
            const d = await (await fetch(API_URL)).json();
            exterior.innerHTML = `${d.current.temperature_2m}°C`;
            apparent.innerHTML = `${d.current.apparent_temperature}°C`;
        }
    </script>

    <!-- Avoid screen sleep -->
    <video id="fake-video" loop style="position: fixed" >
        <source type="video/webm" src="data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA" />
    </video>
    <script>
        const playFn = () => {
            document.getElementById("fake-video").play();
            document.body.removeEventListener('touchend', playFn);
        };
        document.body.addEventListener('touchend', playFn);
    </script>
</body>
</html>
